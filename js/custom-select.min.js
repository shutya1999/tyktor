"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,_toPropertyKey(s.key),s)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var s=o.call(e,t||"default");if("object"!==_typeof(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var CLASS_NAME_SELECT="select",CLASS_NAME_ACTIVE="select_show",CLASS_NAME_SELECTED="select__option_selected",SELECTOR_ACTIVE=".select_show",SELECTOR_DATA="[data-select]",SELECTOR_DATA_TOGGLE='[data-select="toggle"]',SELECTOR_OPTION_SELECTED=".select__option_selected",CustomSelect=function(){function e(t,o){_classCallCheck(this,e),this._elRoot="string"==typeof t?document.querySelector(t):t,this._params=o||{},this._params.options&&(this._elRoot.classList.add(CLASS_NAME_SELECT),this._elRoot.innerHTML=e.template(this._elRoot,this._params)),this._elToggle=this._elRoot.querySelector(SELECTOR_DATA_TOGGLE),this._elHidden=this._elRoot.querySelector("input[type=hidden]"),this._elRoot.addEventListener("click",this._onClick.bind(this,"click")),this._elToggle.addEventListener("focus",this._onClick.bind(this,"focus")),this._elToggle.addEventListener("focusout",this._onBlur.bind(this)),this._params.search&&this._oninput(this._elRoot,this._params),this.afterInit()}return _createClass(e,[{key:"_onBlur",value:function(e){null!==e.relatedTarget&&this.hide()}},{key:"_onClick",value:function(e,t){var o=this;if("focus"===e)setTimeout((function(){o.show()}),300);else{var s=t.target;if(null!==s.closest(SELECTOR_DATA))switch(s.closest(SELECTOR_DATA).dataset.select){case"toggle":this.toggle();break;case"option":this._changeValue(s)}}}},{key:"_update",value:function(e){e=e.closest(".select__option");var t=this._elRoot.querySelector(SELECTOR_OPTION_SELECTED);if(t&&t.classList.remove(CLASS_NAME_SELECTED),e.classList.add(CLASS_NAME_SELECTED),"search"===this._elToggle.dataset.type){this._elToggle.value=e.textContent,this._elHidden.value=e.dataset.value;var o=new Event("blur");this._elToggle.dispatchEvent(o)}else this._elToggle.textContent=e.textContent,this._elToggle.value=e.dataset.value,this._elRoot.classList.add("_selected");return this._elToggle.dataset.index=e.dataset.index,this._elRoot.dispatchEvent(new CustomEvent("select.change")),this._params.onSelected&&this._params.onSelected(this,e),e.dataset.value}},{key:"_reset",value:function(){var e=this._elRoot.querySelector(SELECTOR_OPTION_SELECTED);return e&&e.classList.remove(CLASS_NAME_SELECTED),this._elToggle.textContent="Выберите из списка",this._elToggle.value="",this._elToggle.dataset.index=-1,this._elRoot.dispatchEvent(new CustomEvent("select.change")),this._params.onSelected&&this._params.onSelected(this,null),""}},{key:"_changeValue",value:function(e){e.classList.contains(CLASS_NAME_SELECTED)||this._update(e),this.hide()}},{key:"_oninput",value:function(e,t){var o=this;this._elToggle.addEventListener("input",(function(){var e=o._elToggle.value.trim(),s=[];if(""!==e)t.options.forEach((function(t,n){var l="_hide",a=t[1];-1!==a.toLowerCase().search(e.toLowerCase())&&(l="",a=o._insertMark(a,a.toLowerCase().search(e.toLowerCase()),e.length)),s.push('<li class="select__option '.concat(l,'" data-select="option" data-value="').concat(t[0],'" data-index="').concat(n,'">').concat(a,"</li>"))})),o._elRoot.querySelector(".select__options").innerHTML=s.join("");else{var n=[];t.options.forEach((function(e,t){n.push('<li class="select__option" data-select="option" data-value="'.concat(e[0],'" data-index="').concat(t,'">').concat(e[1],"</li>"))})),o._elRoot.querySelector(".select__options").innerHTML=n.join("")}o._elRoot.dispatchEvent(new CustomEvent("select.input"))}))}},{key:"_insertMark",value:function(e,t,o){return e.slice(0,t)+"<mark>"+e.slice(t,t+o)+"</mark>"+e.slice(t+o)}},{key:"show",value:function(){document.querySelectorAll(SELECTOR_ACTIVE).forEach((function(e){e.classList.remove(CLASS_NAME_ACTIVE)})),this._elRoot.classList.add(CLASS_NAME_ACTIVE)}},{key:"hide",value:function(){this._elRoot.classList.remove(CLASS_NAME_ACTIVE)}},{key:"toggle",value:function(){this._elRoot.classList.contains(CLASS_NAME_ACTIVE)?this.hide():this.show()}},{key:"dispose",value:function(){this._elRoot.removeEventListener("click",this._onClick)}},{key:"value",get:function(){return this._elToggle.value},set:function(e){var t=this,o=!1;if(this._elRoot.querySelectorAll(".select__option").forEach((function(s){if(s.dataset.value===e)return o=!0,t._update(s)})),!o)return this._reset()}},{key:"selectedIndex",get:function(){return this._elToggle.dataset.index},set:function(e){var t=this._elRoot.querySelector('.select__option[data-index="'.concat(e,'"]'));return t?this._update(t):this._reset()}},{key:"option",set:function(e){this._params.options=[],this._params.options=e,this.updateOptions()}},{key:"updateOptions",value:function(){var e=this,t=this._params.options,o=[];t.length>0?t.forEach((function(t,s){var n=t[1],l=e._elToggle.value;-1!==n.toLowerCase().search(l.toLowerCase())&&(n=e._insertMark(n,n.toLowerCase().search(l.toLowerCase()),l.length)),o.push('<li class="select__option " data-select="option" data-value="'.concat(t[0],'" data-index="').concat(s,'">').concat(n,"</li>"))})):o.push('<li class="select__option _click-disabled" data-select="option" data-value="" data-index="-1">'.concat(this._elRoot.dataset.i18Empty,"</li>")),this._elRoot.querySelector(".select__dropdown").classList.remove("_empty"),this._elRoot.querySelector(".select__options").innerHTML=o.join("")}},{key:"afterInit",value:function(){this._elToggle.addEventListener("focus",(function(e){e.isTrusted}))}}]),e}();CustomSelect.template=function(e,t){var o,s=t.name,n=t.options,l=t.targetValue,a=[],i=-1,c="",r="Выберите из списка",_=void 0!==t.placeholder?t.placeholder:"Оберіть із списку або введіть",u=void 0!==t.placeholder?t.placeholder:"Оберіть із списку";if(n.forEach((function(e,t){var o="";e[0]===l&&(o=" select__option_selected",i=t,c=e[0],r=e[1]),a.push('<li class="select__option'.concat(o,'" data-select="option" data-value="').concat(e[0],'" data-index="').concat(t,'">').concat(e[1],"</li>"))})),t.search){var d='<input type="text" class="select__input" placeholder="'.concat(_,'" value="').concat(r,'" data-select="toggle" data-type="search" data-index="').concat(i,'" onblur="selectHandlerBlur(this)" autocomplete="none">');""===c&&(d='<input type="text" placeholder="'.concat(_,'" class="select__input" data-select="toggle" data-type="search" data-index="').concat(i,'" onblur="selectHandlerBlur(this)" autocomplete="none">')),o='\n            <div class="select__toggle">\n                '.concat(d,'\n                <input type="hidden" value="').concat(c,'" name="').concat(s,'">\n            </div>\n        ')}else o='\n            <div class="select__toggle">       \n                <button type="button" name="'.concat(s,'" value="').concat(c,'" data-type="button" data-select="toggle" data-index="').concat(i,'" onblur="selectHandlerBlur(this)">').concat(u,"</button>\n            </div>\n        ");var h="";return h=e.closest(".required")||void 0!==e.dataset.i18Error?'<div class="help-block">'.concat(e.dataset.i18Error,"</div>"):'<div class="help-block"></div>',"\n        ".concat(o,'\n        <div class="select__dropdown ').concat(0===a.length?"_empty":"",'">\n            <ul class="select__options">').concat(a.join(""),"</ul>\n        </div>\n        ").concat(h,"\n    ")},document.addEventListener("click",(function(e){e.target.closest(".select")||document.querySelectorAll(SELECTOR_ACTIVE).forEach((function(e){e.classList.remove(CLASS_NAME_ACTIVE)}))}));var inputs=document.querySelectorAll(".select.required .select__input");function selectHandlerBlur(e){function t(){if(e.closest(".required")){var t=e.closest(".select");null!==t.querySelector(".select__options .select__option.select__option_selected")?t.classList.remove("has-error"):t.classList.add("has-error")}}console.log(e),e.closest("button")?setTimeout((function(){t()}),200):t()}